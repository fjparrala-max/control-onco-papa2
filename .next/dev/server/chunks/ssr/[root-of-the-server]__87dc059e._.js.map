{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 30, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/franc/OneDrive%20-%20Universidad%20Mayor/Escritorio/proyecto%20sergio/control-onco-papa/lib/firebase.ts"],"sourcesContent":["import { initializeApp, getApps } from \"firebase/app\";\r\nimport { getAuth } from \"firebase/auth\";\r\nimport { getFirestore } from \"firebase/firestore\";\r\nimport { getStorage } from \"firebase/storage\";\r\n\r\nconst firebaseConfig = {\r\n  apiKey: process.env.NEXT_PUBLIC_FB_API_KEY!,\r\n  authDomain: process.env.NEXT_PUBLIC_FB_AUTH_DOMAIN!,\r\n  projectId: process.env.NEXT_PUBLIC_FB_PROJECT_ID!,\r\n  storageBucket: process.env.NEXT_PUBLIC_FB_STORAGE_BUCKET!,\r\n  messagingSenderId: process.env.NEXT_PUBLIC_FB_SENDER_ID!,\r\n  appId: process.env.NEXT_PUBLIC_FB_APP_ID!\r\n};\r\n\r\nconst app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);\r\n\r\nexport const auth = getAuth(app);\r\nexport const db = getFirestore(app);\r\nexport const storage = getStorage(app);\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;AACA;;;;;;;;;;;;AAEA,MAAM,iBAAiB;IACrB,MAAM;IACN,UAAU;IACV,SAAS;IACT,aAAa;IACb,iBAAiB;IACjB,KAAK;AACP;AAEA,MAAM,MAAM,IAAA,wLAAO,IAAG,MAAM,GAAG,IAAA,wLAAO,GAAE,CAAC,EAAE,GAAG,IAAA,8LAAa,EAAC;AAErD,MAAM,OAAO,IAAA,0LAAO,EAAC;AACrB,MAAM,KAAK,IAAA,yMAAY,EAAC;AACxB,MAAM,UAAU,IAAA,mMAAU,EAAC"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/franc/OneDrive%20-%20Universidad%20Mayor/Escritorio/proyecto%20sergio/control-onco-papa/pages/casos.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport { useRouter } from \"next/router\";\r\nimport { auth, db } from \"../lib/firebase\";\r\nimport { onAuthStateChanged, signOut } from \"firebase/auth\";\r\nimport { addDoc, collection, getDocs, serverTimestamp, setDoc, doc } from \"firebase/firestore\";\r\n\r\ntype CaseIndex = {\r\n  id: string;\r\n  name: string;\r\n  role: \"admin\" | \"member\";\r\n};\r\n\r\nexport default function CasosPage() {\r\n  const router = useRouter();\r\n  const [uid, setUid] = useState<string | null>(null);\r\n  const [cases, setCases] = useState<CaseIndex[]>([]);\r\n  const [name, setName] = useState(\"\");\r\n  const [joinId, setJoinId] = useState(\"\");\r\n  const [loading, setLoading] = useState(true);\r\n  const [creating, setCreating] = useState(false);\r\n  const [joining, setJoining] = useState(false);\r\n  const [msg, setMsg] = useState<string>(\"\");\r\n\r\n  async function loadCases(userId: string) {\r\n    setMsg(\"Cargando casos…\");\r\n    const snap = await getDocs(collection(db, \"caseMembers\", userId, \"cases\"));\r\n    const list: CaseIndex[] = snap.docs.map((d) => {\r\n      const data = d.data() as any;\r\n      return { id: d.id, name: data.name || \"(Sin nombre)\", role: data.role || \"member\" };\r\n    });\r\n    list.sort((a, b) => a.name.localeCompare(b.name));\r\n    setCases(list);\r\n    setMsg(\"\");\r\n  }\r\n\r\n  useEffect(() => {\r\n    const unsub = onAuthStateChanged(auth, async (u) => {\r\n      try {\r\n        if (!u) {\r\n          router.replace(\"/login\");\r\n          return;\r\n        }\r\n        setUid(u.uid);\r\n        setLoading(true);\r\n        await loadCases(u.uid);\r\n      } catch (e: any) {\r\n        console.error(e);\r\n        setMsg(e?.message || \"Error cargando casos\");\r\n        alert(e?.message || \"Error cargando casos\");\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    });\r\n    return () => unsub();\r\n  }, [router]);\r\n\r\n  async function createCase() {\r\n    if (!uid) return;\r\n    const nm = name.trim();\r\n    if (!nm) return alert(\"Pon un nombre, ej: Papá Sergio\");\r\n\r\n    try {\r\n      setCreating(true);\r\n      setMsg(\"Creando caso…\");\r\n\r\n      // 1) Crear caso\r\n      const ref = await addDoc(collection(db, \"cases\"), {\r\n        name: nm,\r\n        createdBy: uid,\r\n        members: { [uid]: \"admin\" },\r\n        createdAt: serverTimestamp()\r\n      });\r\n\r\n      // 2) Índice para listar casos del usuario (rápido)\r\n      await setDoc(doc(db, \"caseMembers\", uid, \"cases\", ref.id), {\r\n        name: nm,\r\n        role: \"admin\",\r\n        addedAt: serverTimestamp()\r\n      });\r\n\r\n      setName(\"\");\r\n      await loadCases(uid);\r\n\r\n      // 3) Dejarlo activo y volver a Home\r\n      localStorage.setItem(\"activeCaseId\", ref.id);\r\n      router.push(\"/\");\r\n    } catch (e: any) {\r\n      console.error(e);\r\n      alert(e?.message || \"No se pudo crear el caso\");\r\n      setMsg(e?.message || \"No se pudo crear el caso\");\r\n    } finally {\r\n      setCreating(false);\r\n      setMsg(\"\");\r\n    }\r\n  }\r\n\r\n  // ✅ Unirse a un caso por ID (para familiares)\r\n  async function joinCase() {\r\n    if (!uid) return;\r\n    const caseId = joinId.trim();\r\n    if (!caseId) return alert(\"Pega el ID del caso\");\r\n\r\n    try {\r\n      setJoining(true);\r\n      setMsg(\"Uniéndome al caso…\");\r\n\r\n      // MVP: solo creamos el índice en el usuario (aparece en su lista)\r\n      await setDoc(doc(db, \"caseMembers\", uid, \"cases\", caseId), {\r\n        name: \"(pendiente)\",\r\n        role: \"member\",\r\n        addedAt: serverTimestamp()\r\n      });\r\n\r\n      setJoinId(\"\");\r\n      await loadCases(uid);\r\n      setMsg(\"\");\r\n      alert(\"Listo. El caso debería aparecer en tu lista.\");\r\n    } catch (e: any) {\r\n      console.error(e);\r\n      alert(e?.message || \"No se pudo unir al caso\");\r\n      setMsg(e?.message || \"No se pudo unir al caso\");\r\n    } finally {\r\n      setJoining(false);\r\n      setMsg(\"\");\r\n    }\r\n  }\r\n\r\n  async function openCase(caseId: string) {\r\n    localStorage.setItem(\"activeCaseId\", caseId);\r\n    router.push(\"/\");\r\n  }\r\n\r\n  async function logout() {\r\n    await signOut(auth);\r\n    router.replace(\"/login\");\r\n  }\r\n\r\n  const active = typeof window !== \"undefined\" ? localStorage.getItem(\"activeCaseId\") : null;\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"container\">\r\n        <h1>Casos</h1>\r\n        <div className=\"card\">{msg || \"Cargando…\"}</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <h1>Casos</h1>\r\n\r\n      <div className=\"card\" style={{ marginBottom: 12 }}>\r\n        <b>Crear caso compartido</b>\r\n        <div style={{ marginTop: 10, display: \"grid\", gap: 10 }}>\r\n          <input value={name} onChange={(e) => setName(e.target.value)} placeholder=\"Ej: Papá Sergio\" />\r\n          <button className=\"btn\" onClick={createCase} disabled={creating}>\r\n            {creating ? \"Creando…\" : \"Crear\"}\r\n          </button>\r\n          {msg && <small>{msg}</small>}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"card\" style={{ marginBottom: 12 }}>\r\n        <b>Unirme a un caso por ID</b>\r\n        <div style={{ marginTop: 10, display: \"grid\", gap: 10 }}>\r\n          <input value={joinId} onChange={(e) => setJoinId(e.target.value)} placeholder=\"Pega aquí el ID del caso\" />\r\n          <button className=\"btn2\" onClick={joinCase} disabled={joining}>\r\n            {joining ? \"Uniéndome…\" : \"Unirme\"}\r\n          </button>\r\n          <small>Tu familiar te pasa el “ID” del caso y listo.</small>\r\n        </div>\r\n      </div>\r\n\r\n      <div style={{ display: \"grid\", gap: 10 }}>\r\n        {cases.map((c) => (\r\n          <div className=\"card\" key={c.id}>\r\n            <div style={{ display: \"flex\", justifyContent: \"space-between\", gap: 10 }}>\r\n              <div>\r\n                <b>{c.name}</b>\r\n                <div>\r\n                  <small>\r\n                    Rol: {c.role} {active === c.id ? \"• (Activo)\" : \"\"}\r\n                  </small>\r\n                </div>\r\n                <div><small>ID: {c.id}</small></div>\r\n              </div>\r\n              <button className=\"btn2\" onClick={() => openCase(c.id)}>Abrir</button>\r\n            </div>\r\n          </div>\r\n        ))}\r\n        {!cases.length && <div className=\"card\">No tienes casos aún.</div>}\r\n      </div>\r\n\r\n      <div style={{ marginTop: 12 }} className=\"row\">\r\n        <button className=\"btn2\" onClick={logout}>Cerrar sesión</button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}