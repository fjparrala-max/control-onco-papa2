{"version":3,"sources":["../../../../pages/casos.tsx","../../../../node_modules/next/src/build/templates/pages.ts"],"sourcesContent":["import { useEffect, useMemo, useState } from \"react\";\r\nimport { useRouter } from \"next/router\";\r\nimport { auth, db } from \"../lib/firebase\";\r\nimport { onAuthStateChanged, signOut } from \"firebase/auth\";\r\nimport { addDoc, collection, doc, getDoc, getDocs, query, serverTimestamp, setDoc, where } from \"firebase/firestore\";\r\n\r\ntype CaseDoc = {\r\n  id: string;\r\n  name: string;\r\n  createdBy: string;\r\n  members: Record<string, \"admin\" | \"member\">;\r\n};\r\n\r\nexport default function CasosPage() {\r\n  const router = useRouter();\r\n  const [uid, setUid] = useState<string | null>(null);\r\n  const [cases, setCases] = useState<CaseDoc[]>([]);\r\n  const [name, setName] = useState(\"\");\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  async function loadCases(userId: string) {\r\n    // Trae casos donde members.<uid> existe (guardamos members como map)\r\n    // Firestore no permite query directo por “campo dinámico” en todos los casos.\r\n    // Para MVP: guardamos además una colección auxiliar: caseMembers/{uid}/cases/{caseId}\r\n    const snap = await getDocs(collection(db, \"caseMembers\", userId, \"cases\"));\r\n    const ids = snap.docs.map(d => d.id);\r\n\r\n    const results: CaseDoc[] = [];\r\n    for (const caseId of ids) {\r\n      const c = await getDoc(doc(db, \"cases\", caseId));\r\n      if (c.exists()) {\r\n        const data = c.data() as any;\r\n        results.push({\r\n          id: c.id,\r\n          name: data.name,\r\n          createdBy: data.createdBy,\r\n          members: data.members || {}\r\n        });\r\n      }\r\n    }\r\n    setCases(results);\r\n  }\r\n\r\n  useEffect(() => {\r\n    const unsub = onAuthStateChanged(auth, async (u) => {\r\n      if (!u) {\r\n        router.replace(\"/login\");\r\n        return;\r\n      }\r\n      setUid(u.uid);\r\n      setLoading(true);\r\n      await loadCases(u.uid);\r\n      setLoading(false);\r\n    });\r\n    return () => unsub();\r\n  }, [router]);\r\n\r\n  async function createCase() {\r\n    if (!uid) return;\r\n    if (!name.trim()) return alert(\"Pon un nombre, ej: Papá Sergio\");\r\n\r\n    // 1) Crear caso\r\n    const ref = await addDoc(collection(db, \"cases\"), {\r\n      name: name.trim(),\r\n      createdBy: uid,\r\n      members: { [uid]: \"admin\" },\r\n      createdAt: serverTimestamp()\r\n    });\r\n\r\n    // 2) Índice para listar casos del usuario\r\n    await setDoc(doc(db, \"caseMembers\", uid, \"cases\", ref.id), {\r\n      role: \"admin\",\r\n      addedAt: serverTimestamp()\r\n    });\r\n\r\n    setName(\"\");\r\n    await loadCases(uid);\r\n  }\r\n\r\n  async function openCase(caseId: string) {\r\n    localStorage.setItem(\"activeCaseId\", caseId);\r\n    router.push(\"/\");\r\n  }\r\n\r\n  async function logout() {\r\n    await signOut(auth);\r\n    router.replace(\"/login\");\r\n  }\r\n\r\n  const active = typeof window !== \"undefined\" ? localStorage.getItem(\"activeCaseId\") : null;\r\n\r\n  if (loading) return <div className=\"container\"><div className=\"card\">Cargando…</div></div>;\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <h1>Casos</h1>\r\n\r\n      <div className=\"card\" style={{ marginBottom: 12 }}>\r\n        <b>Crear caso compartido</b>\r\n        <div style={{ marginTop: 10, display: \"grid\", gap: 10 }}>\r\n          <input value={name} onChange={(e) => setName(e.target.value)} placeholder=\"Ej: Papá Sergio\" />\r\n          <button className=\"btn\" onClick={createCase}>Crear</button>\r\n          <small>Luego invitaremos familiares (próximo paso).</small>\r\n        </div>\r\n      </div>\r\n\r\n      <div style={{ display: \"grid\", gap: 10 }}>\r\n        {cases.map((c) => (\r\n          <div className=\"card\" key={c.id}>\r\n            <div style={{ display: \"flex\", justifyContent: \"space-between\", gap: 10 }}>\r\n              <div>\r\n                <b>{c.name}</b>\r\n                <div><small>ID: {c.id}</small></div>\r\n                {active === c.id && <div><small><b>Activo</b></small></div>}\r\n              </div>\r\n              <button className=\"btn2\" onClick={() => openCase(c.id)}>Abrir</button>\r\n            </div>\r\n          </div>\r\n        ))}\r\n        {!cases.length && <div className=\"card\">No tienes casos aún.</div>}\r\n      </div>\r\n\r\n      <div style={{ marginTop: 12 }} className=\"row\">\r\n        <button className=\"btn2\" onClick={logout}>Cerrar sesión</button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import { PagesRouteModule } from '../../server/route-modules/pages/module.compiled'\nimport { RouteKind } from '../../server/route-kind'\n\nimport { hoist } from './helpers'\n\n// Import the app and document modules.\nimport * as document from 'VAR_MODULE_DOCUMENT'\nimport * as app from 'VAR_MODULE_APP'\n\n// Import the userland code.\nimport * as userland from 'VAR_USERLAND'\nimport { getHandler } from '../../server/route-modules/pages/pages-handler'\n\n// Re-export the component (should be the default export).\nexport default hoist(userland, 'default')\n\n// Re-export methods.\nexport const getStaticProps = hoist(userland, 'getStaticProps')\nexport const getStaticPaths = hoist(userland, 'getStaticPaths')\nexport const getServerSideProps = hoist(userland, 'getServerSideProps')\nexport const config = hoist(userland, 'config')\nexport const reportWebVitals = hoist(userland, 'reportWebVitals')\n\n// Re-export legacy methods.\nexport const unstable_getStaticProps = hoist(\n  userland,\n  'unstable_getStaticProps'\n)\nexport const unstable_getStaticPaths = hoist(\n  userland,\n  'unstable_getStaticPaths'\n)\nexport const unstable_getStaticParams = hoist(\n  userland,\n  'unstable_getStaticParams'\n)\nexport const unstable_getServerProps = hoist(\n  userland,\n  'unstable_getServerProps'\n)\nexport const unstable_getServerSideProps = hoist(\n  userland,\n  'unstable_getServerSideProps'\n)\n\n// Create and export the route module that will be consumed.\nexport const routeModule = new PagesRouteModule({\n  definition: {\n    kind: RouteKind.PAGES,\n    page: 'VAR_DEFINITION_PAGE',\n    pathname: 'VAR_DEFINITION_PATHNAME',\n    // The following aren't used in production.\n    bundlePath: '',\n    filename: '',\n  },\n  distDir: process.env.__NEXT_RELATIVE_DIST_DIR || '',\n  relativeProjectDir: process.env.__NEXT_RELATIVE_PROJECT_DIR || '',\n  components: {\n    // default export might not exist when optimized for data only\n    App: app.default,\n    Document: document.default,\n  },\n  userland,\n})\n\nexport const handler = getHandler({\n  srcPage: 'VAR_DEFINITION_PAGE',\n  config,\n  userland,\n  routeModule,\n  getStaticPaths,\n  getStaticProps,\n  getServerSideProps,\n})\n"],"names":["PagesRouteModule","RouteKind","hoist","document","app","userland","getHandler","getStaticProps","getStaticPaths","getServerSideProps","config","reportWebVitals","unstable_getStaticProps","unstable_getStaticPaths","unstable_getStaticParams","unstable_getServerProps","unstable_getServerSideProps","routeModule","definition","kind","PAGES","page","pathname","bundlePath","filename","distDir","process","env","__NEXT_RELATIVE_DIST_DIR","relativeProjectDir","__NEXT_RELATIVE_PROJECT_DIR","components","App","default","Document","handler","srcPage"],"mappings":"6DAAA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,mBASe,SAAS,IACtB,IAAM,EAAS,CAAA,EAAA,EAAA,SAAS,AAAT,IACT,CAAC,EAAK,EAAO,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MACxC,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAY,EAAE,EAC1C,CAAC,EAAM,EAAQ,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IAC3B,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,GAAS,GAEvC,eAAe,EAAU,CAAc,EAKrC,IAAM,EAAM,CADC,MAAM,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC,EAAA,EAAE,CAAE,cAAe,EAAQ,SAAA,EAChD,IAAI,CAAC,GAAG,CAAC,GAAK,EAAE,EAAE,EAE7B,EAAqB,EAAE,CAC7B,IAAK,IAAM,KAAU,EAAK,CACxB,IAAM,EAAI,MAAM,CAAA,EAAA,EAAA,MAAA,AAAM,EAAC,CAAA,EAAA,EAAA,GAAA,AAAG,EAAC,EAAA,EAAE,CAAE,QAAS,IACxC,GAAI,EAAE,MAAM,GAAI,CACd,IAAM,EAAO,EAAE,IAAI,GACnB,EAAQ,IAAI,CAAC,CACX,GAAI,EAAE,EAAE,CACR,KAAM,EAAK,IAAI,CACf,UAAW,EAAK,SAAS,CACzB,QAAS,EAAK,OAAO,EAAI,CAAC,CAC5B,EACF,CACF,CACA,EAAS,EACX,CAgBA,eAAe,IACb,GAAI,CAAC,EAAK,OACV,GAAI,CAAC,EAAK,IAAI,GAAI,OAAO,MAAM,kCAG/B,IAAM,EAAM,MAAM,CAAA,EAAA,EAAA,MAAA,AAAM,EAAC,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC,EAAA,EAAE,CAAE,SAAU,CAChD,KAAM,EAAK,IAAI,GACf,UAAW,EACX,QAAS,CAAE,CAAC,EAAI,CAAE,OAAQ,EAC1B,UAAW,CAAA,EAAA,EAAA,eAAA,AAAe,GAC5B,EAGA,OAAM,CAAA,EAAA,EAAA,MAAA,AAAM,EAAC,CAAA,EAAA,EAAA,GAAA,AAAG,EAAC,EAAA,EAAE,CAAE,cAAe,EAAK,QAAS,EAAI,EAAE,EAAG,CACzD,KAAM,QACN,QAAS,CAAA,EAAA,EAAA,eAAA,AAAe,GAC1B,GAEA,EAAQ,IACR,MAAM,EAAU,EAClB,CAEA,eAAe,EAAS,CAAc,EACpC,aAAa,OAAO,CAAC,eAAgB,GACrC,EAAO,IAAI,CAAC,IACd,CAEA,eAAe,IACb,MAAM,CAAA,EAAA,EAAA,OAAA,AAAO,EAAC,EAAA,IAAI,EAClB,EAAO,OAAO,CAAC,SACjB,QA5CA,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,IAAM,EAAQ,CAAA,EAAA,EAAA,kBAAA,AAAkB,EAAC,EAAA,IAAI,CAAE,MAAO,IAC5C,AAAK,GAAG,AAIR,CAJI,CAIG,EAAE,GAAG,EACZ,GAAW,GACX,MAAM,EAAU,EAAE,GAAG,EACrB,GAAW,IANT,EAAO,OAAO,CAAC,SAOnB,GACA,MAAO,IAAM,GACf,EAAG,CAAC,EAAO,EAoCP,GAAgB,CAAA,EAAA,EAAA,CAAP,EAAO,EAAC,MAAA,CAAI,UAAU,qBAAY,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gBAAO,gBAGnE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,UAAG,UAEJ,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,OAAO,MAAO,CAAE,aAAc,EAAG,YAC9C,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,UAAE,0BACH,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,MAAO,CAAE,UAAW,GAAI,QAAS,OAAQ,IAAK,EAAG,YACpD,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,MAAO,EAAM,SAAU,AAAC,GAAM,EAAQ,EAAE,MAAM,CAAC,KAAK,EAAG,YAAY,oBAC1E,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,UAAU,MAAM,QAAS,WAAY,UAC7C,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,UAAM,uDAIX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,MAAO,CAAE,QAAS,OAAQ,IAAK,EAAG,YACpC,EAAM,GAAG,CAAC,AAAC,GACV,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gBACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,MAAO,CAAE,QAAS,OAAQ,eAAgB,gBAAiB,IAAK,EAAG,YACtE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,UAAG,EAAE,IAAI,GACV,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,UAAI,CAAA,EAAA,EAAA,IAAA,EAAC,QAAA,WAAM,OAAK,EAAE,EAAE,MACpB,AAxBuE,OAwB5D,EAAE,EAAE,EAAI,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,UAAI,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,UAAM,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,UAAE,kBAErC,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,UAAU,OAAO,QAAS,IAAM,EAAS,EAAE,EAAE,WAAG,cAPjC,EAAE,EAAE,GAWhC,CAAC,EAAM,MAAM,EAAI,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gBAAO,4BAG1C,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,MAAO,CAAE,UAAW,EAAG,EAAG,UAAU,eACvC,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,UAAU,OAAO,QAAS,WAAQ,sBAIlD,yGC/HA,IAAA,EAAiC,EAAA,CAAxBA,AAAwB,CAAA,MACjC,EAA0B,EAAyB,CAA1CC,AAA0C,CAAA,GAD1B,CAC0B,AADgC,EAGnF,EAFkB,AAEe,EAAA,CAHA,AAGxBC,AAAwB,CAAA,IAAnB,AAFY,EAK1B,EAA0B,EAAqB,CAAA,CAHzB,AAGyB,EAAnCC,IACZ,EAAqC,EAAA,CAAA,CAJJ,AAII,EAAzBC,EADc,EAI1B,EAAwC,EAAA,CAHnB,AAGmB,CAAA,EAA5BC,IACZ,EAA2B,EAAA,CAAlBC,AAAkB,CAAA,IAJU,AAGX,IACiD,CAAxD,QAAQ,EADa,8BAIzBJ,EAAAA,KAAAA,EAAMG,EAAU,WAAU,AAG5BE,EAAAA,CAAAA,EAAiBL,EAAAA,KAAAA,EAAMG,EAAU,kBAAiB,AAClDG,EAAAA,CAAAA,EAAiBN,EAAAA,KAAAA,EAAMG,EAAU,kBACjCI,AADkD,EAClDA,CAAAA,EAAqBP,EAAAA,KAAAA,EAAMG,EAAU,sBAAqB,AAC1DK,EAAAA,CAAAA,EAASR,EAAAA,KAAAA,EAAMG,EAAU,UAAS,AAClCM,EAAAA,CAAAA,EAAkBT,EAAAA,KAAAA,EAAMG,EAAU,mBAAkB,AAGpDO,EAAAA,CAAAA,EAA0BV,EAAAA,KAAAA,EACrCG,EACA,2BACD,AACYQ,EAAAA,CAAAA,EAA0BX,EAAAA,KAAAA,EACrCG,EACA,2BACD,AACYS,EAAAA,CAAAA,EAA2BZ,EAAAA,KAAAA,EACtCG,EACA,4BACD,AACYU,EAAAA,CAAAA,EAA0Bb,EAAAA,KAAAA,EACrCG,EACA,2BAEWW,AADZ,EACYA,CAAAA,EAA8Bd,EAAAA,KAAAA,EACzCG,EACA,+BACD,AAGYY,EAAc,IAAIjB,EAAAA,gBAAAA,CAAiB,CAC9CkB,WAAY,CACVC,KAAMlB,EAAAA,SAAAA,CAAUmB,KAAK,CACrBC,KAAM,SACNC,SAAU,SAEVC,WAAY,GACZC,SAAU,EACZ,EACAC,QAAqBG,CAAZF,EAAoC,KAC7CG,CADiBF,GAAG,AAA6B,CAA5BC,cAC0C,CAA3CF,EACpBK,MAD4BJ,GAAG,CAACG,CACpB,CAEVE,IAAK5B,EAAI6B,EAAAA,KAAO,CAChBC,SAAU/B,EAJ+C,AAItC8B,OAAAA,AAAO,AAC5B,WACA5B,CACF,GAAE,AAEW8B,EAAAA,CAAAA,EAAU7B,EAAAA,UAAAA,EAAW,CAChC8B,QAAS,SACT1B,kBACAL,cACAY,iBACAT,iBACAD,qBACAE,CACF,GAAE","ignoreList":[1]}